"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[334],{1886:(t,e,o)=>{o.d(e,{HW:()=>u,JZ:()=>k,M2:()=>I,MW:()=>O,QM:()=>E,SV:()=>w,TK:()=>d,Uq:()=>h,Ww:()=>p,_P:()=>P,_Q:()=>v,ag:()=>m,ar:()=>b,d:()=>y,ge:()=>T,hG:()=>f,iD:()=>c,jX:()=>N,kz:()=>i,oE:()=>A,ri:()=>l,s$:()=>S,y_:()=>g});let n="http://18.226.28.25:3001/api",r=()=>sessionStorage.getItem("token"),s=t=>!!t&&/^[A-Za-z0-9-_=]+\.[A-Za-z0-9-_=]+\.[A-Za-z0-9-_.+/=]*$/.test(t);async function a(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},o=r(),a=s(o)?o:null;o&&!a&&(console.warn("API: Invalid token format detected, clearing token"),sessionStorage.removeItem("token"));let i={"Content-Type":"application/json",...a?{Authorization:"Bearer ".concat(a)}:{},...e.headers||{}};console.log("API: Making request to ".concat(t," with token: ").concat(a?"Present":"Not present"));try{let r=await fetch("".concat(n).concat(t),{...e,headers:i});if(!r.ok){let e;let n=await r.text();try{e=JSON.parse(n)}catch(t){e={message:n||"API request failed with status ".concat(r.status)}}console.error("API: Error for ".concat(t,":"),r.status,e),401===r.status&&o&&(console.warn("API: Received 401 with token present, clearing invalid token"),sessionStorage.removeItem("token"));let s=Error(e.message||"API request failed with status ".concat(r.status));throw s.status=r.status,s}return r.json()}catch(e){throw console.error("API: Request error for ".concat(t,":"),e),e}}async function i(t,e){let o=await a("/auth/register",{method:"POST",body:JSON.stringify({email:t,password:e})});return o.token&&sessionStorage.setItem("token",o.token),o}async function c(t,e){let o=await a("/auth/login",{method:"POST",body:JSON.stringify({email:t,password:e})});return o.token&&sessionStorage.setItem("token",o.token),o}async function u(){return a("/auth/me")}async function l(){return sessionStorage.removeItem("token"),Promise.resolve()}async function d(t){return a("/users",{method:"PUT",body:JSON.stringify(t)})}async function f(){return a("/users",{method:"DELETE"})}async function h(){return a("/files")}async function g(t){return a("/files/".concat(t,"/download-url"))}async function p(t){return a("/files/".concat(t),{method:"DELETE"})}async function y(t){return a("/links",{method:"POST",body:JSON.stringify(t)})}async function m(){return a("/links")}async function S(t,e){return a("/links/".concat(t),{method:"PUT",body:JSON.stringify(e)})}async function k(t){return a("/links/".concat(t,"/revoke"),{method:"POST"})}async function v(t){return a("/links/".concat(t,"/activate"),{method:"POST"})}async function w(t){return a("/links/".concat(t),{method:"DELETE"})}async function A(){return a("/subscription/plan")}async function T(t){return a("/subscription/upgrade",{method:"POST",body:JSON.stringify({planId:t})})}async function I(){return a("/subscription/cancel",{method:"POST"})}async function E(t,e){let o=r(),s=new FormData;return s.append("file",t),new Promise((t,r)=>{let a=new XMLHttpRequest;a.open("POST","".concat(n,"/files/upload")),o&&a.setRequestHeader("Authorization","Bearer ".concat(o)),a.upload.addEventListener("progress",t=>{t.lengthComputable&&e&&e(Math.round(t.loaded/t.total*100))}),a.onload=()=>{if(a.status>=200&&a.status<300)try{let e=JSON.parse(a.responseText);t(e)}catch(t){r(Error("Invalid response format"))}else{let t="Upload failed";try{t=JSON.parse(a.responseText).message||t}catch(e){t=a.statusText||t}413===a.status?t="File is too large. Maximum size is 100MB.":400===a.status&&(t="No file was provided for upload."),r(Error(t))}},a.onerror=()=>{r(Error("Network error occurred during upload"))},a.send(s)})}async function O(t){try{let e=await fetch("".concat(n,"/public/links/").concat(t));if(!e.ok){let t=await e.text(),o="Failed to get link info: ".concat(e.status);try{o=JSON.parse(t).message||o}catch(e){t&&(o=t)}let n=Error(o);throw n.status=e.status,n}return e.json()}catch(t){throw console.error("Request error for link info:",t),t}}async function P(t,e){console.log("Getting file content for link ".concat(t,", password provided: ").concat(e?"Yes":"No"));let o=e?"POST":"GET",r=e?JSON.stringify({password:e}):void 0;try{console.log("Making ".concat(o," request to get file content, with password: ").concat(e?"Yes":"No"));let s=await fetch("".concat(n,"/public/links/").concat(t,"/content"),{method:o,headers:{"Content-Type":"application/json"},body:r});if(!s.ok){let t=await s.text(),e="Failed to get file content: ".concat(s.status);try{e=JSON.parse(t).message||e}catch(o){t&&(e=t)}401===s.status?e="Password required":404===s.status?e="File not found. It may have been deleted or moved.":403===s.status?e="You don't have permission to access this file.":s.status>=500&&(e="Server error. Please try again later."),console.error("API error for file content:",s.status,e);let o=Error(e);throw o.status=s.status,o}let a=await s.json();if(!a.viewUrl&&!a.fileUrl)throw Error("Invalid response: Missing file URL");return a.viewUrl&&!a.fileUrl&&(a.fileUrl=a.viewUrl),a}catch(t){throw console.error("Request error for file content:",t),t}}async function N(t,e){return fetch("".concat(n,"/public/links/").concat(t,"/verify-password"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({password:e})}).then(async t=>{if(!t.ok){if(401===t.status)return{success:!1};throw Error("Failed to verify password: ".concat(t.status))}return await t.json()})}async function b(t){let e=new URLSearchParams;(null==t?void 0:t.linkId)&&e.append("linkId",t.linkId),(null==t?void 0:t.action)&&e.append("action",t.action),(null==t?void 0:t.startDate)&&e.append("startDate",t.startDate),(null==t?void 0:t.endDate)&&e.append("endDate",t.endDate);let o=e.toString();try{let t=await a("/access/logs".concat(o?"?".concat(o):""));if(!t.logs&&Array.isArray(t))return{logs:t};return t}catch(t){throw console.error("Error fetching access logs:",t),t}}},3243:(t,e,o)=>{o.d(e,{A:()=>l,AuthProvider:()=>u});var n=o(5155),r=o(2115),s=o(5695),a=o(1886),i=o(4503);let c=(0,r.createContext)(void 0);function u(t){let{children:e}=t,[o,u]=(0,r.useState)(null),[l,d]=(0,r.useState)(!0),[f,h]=(0,r.useState)(null),g=(0,s.useRouter)(),{toast:p}=(0,i.dj)(),y=async()=>{console.log("Auth: Refreshing user data"),h(null);try{if(!sessionStorage.getItem("token")){console.log("Auth: No token found during refresh"),u(null);return}console.log("Auth: Token found, fetching user data");let t=await (0,a.HW)();console.log("Auth: User data fetched successfully"),u(t.user),p({title:"Session refreshed",description:"Your session has been refreshed successfully.",variant:"default"})}catch(t){console.error("Auth: Error refreshing user data:",t),h(t.message||"Failed to authenticate user"),500===t.status?(console.warn("Auth: Backend server error (500), keeping token for retry"),p({variant:"destructive",title:"Server error",description:"The server encountered an error. Please try again later."})):(sessionStorage.removeItem("token"),u(null),p({variant:"destructive",title:"Authentication error",description:t.message||"Failed to authenticate user."}))}};(0,r.useEffect)(()=>{(async()=>{d(!0),console.log("Auth: Initial auth check");try{await y()}catch(t){console.error("Auth: Initial auth check error:",t)}finally{d(!1)}})()},[]);let m=async(t,e)=>{console.log("Auth: Login attempt"),h(null);try{let o=await (0,a.iD)(t,e);return console.log("Auth: Login successful, token received"),o.token&&(sessionStorage.setItem("token",o.token),u(o.user)),p({title:"Login successful",description:"Welcome back to DocuShare!",variant:"default"}),o}catch(t){throw console.error("Auth: Login error:",t),h(t.message||"Login failed"),p({variant:"destructive",title:"Login failed",description:t.message||"Invalid email or password."}),t}},S=async(t,e)=>{console.log("Auth: Register attempt"),h(null);try{let o=await (0,a.kz)(t,e);return console.log("Auth: Registration successful, token received"),o.token&&(sessionStorage.setItem("token",o.token),u(o.user)),p({title:"Registration successful",description:"Your account has been created successfully.",variant:"default"}),o}catch(t){throw console.error("Auth: Registration error:",t),h(t.message||"Registration failed"),p({variant:"destructive",title:"Registration failed",description:t.message||"There was a problem creating your account."}),t}},k=!!sessionStorage.getItem("token");return(0,n.jsx)(c.Provider,{value:{user:o,isLoading:l,isAuthenticated:!!o||k,login:m,register:S,logout:()=>{console.log("Auth: Logging out, clearing token"),h(null),(0,a.ri)(),sessionStorage.removeItem("token"),u(null),p({title:"Logged out",description:"You have been logged out successfully.",variant:"default"}),g.push("/")},refreshUser:y,authError:f},children:e})}function l(){let t=(0,r.useContext)(c);if(void 0===t)throw Error("useAuth must be used within an AuthProvider");return t}},3999:(t,e,o)=>{o.d(e,{Yq:()=>i,cn:()=>s,z3:()=>a});var n=o(2596),r=o(9688);function s(){for(var t=arguments.length,e=Array(t),o=0;o<t;o++)e[o]=arguments[o];return(0,r.QP)((0,n.$)(e))}function a(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;if(0===t)return"0 Bytes";let o=Math.floor(Math.log(t)/Math.log(1024));return Number.parseFloat((t/Math.pow(1024,o)).toFixed(e<0?0:e))+" "+["Bytes","KB","MB","GB","TB","PB","EB","ZB","YB"][o]}function i(t){if(!t)return"N/A";let e=new Date(t);return isNaN(e.getTime())?"Invalid date":new Intl.DateTimeFormat("en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}).format(e)}},4503:(t,e,o)=>{o.d(e,{dj:()=>f});var n=o(2115);let r=0,s=new Map,a=t=>{if(s.has(t))return;let e=setTimeout(()=>{s.delete(t),l({type:"REMOVE_TOAST",toastId:t})},5e3);s.set(t,e)},i=(t,e)=>{switch(e.type){case"ADD_TOAST":return{...t,toasts:[e.toast,...t.toasts].slice(0,5)};case"UPDATE_TOAST":return{...t,toasts:t.toasts.map(t=>t.id===e.toast.id?{...t,...e.toast}:t)};case"DISMISS_TOAST":{let{toastId:o}=e;return o?a(o):t.toasts.forEach(t=>{a(t.id)}),{...t,toasts:t.toasts.map(t=>t.id===o||void 0===o?{...t,open:!1}:t)}}case"REMOVE_TOAST":if(void 0===e.toastId)return{...t,toasts:[]};return{...t,toasts:t.toasts.filter(t=>t.id!==e.toastId)}}},c=[],u={toasts:[]};function l(t){u=i(u,t),c.forEach(t=>{t(u)})}function d(t){let{...e}=t,o=(r=(r+1)%Number.MAX_VALUE).toString(),n=()=>l({type:"DISMISS_TOAST",toastId:o});return l({type:"ADD_TOAST",toast:{...e,id:o,open:!0,onOpenChange:t=>{t||n()}}}),{id:o,dismiss:n,update:t=>l({type:"UPDATE_TOAST",toast:{...t,id:o}})}}function f(){let[t,e]=(0,n.useState)(u);return(0,n.useEffect)(()=>(c.push(e),()=>{let t=c.indexOf(e);t>-1&&c.splice(t,1)}),[t]),{...t,toast:d,dismiss:t=>l({type:"DISMISS_TOAST",toastId:t})}}}}]);